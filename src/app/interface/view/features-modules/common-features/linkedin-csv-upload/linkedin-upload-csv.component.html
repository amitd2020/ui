<p-messages [value]="msgs"></p-messages>

<ng-template #showUpgradePlanBlock>
	<ng-container *ngIf="isClientUser; else otherThanClientUserLoggedIn">
		<div class="card text-center">
			To enable this feature, please contact your Administrator.
		</div>
	</ng-container>
	<ng-template #otherThanClientUserLoggedIn>
		<p-card>
			<dg-upgrade-plan [currentPlan]="currentPlan"></dg-upgrade-plan>
		</p-card>		
	</ng-template>	
</ng-template>

<!-- <ng-container *ngIf="userAuthService.hasFeaturePermission( 'Upload CSV' ) || userAuthService.hasRolePermission( ['Super Admin'] ); else showUpgradePlanBlock"> -->
<div addOnAccess="developerFeatures" optionalTemplate="true">
	<ng-container *ngIf="!displayUplaodPanel">
		<div class="grid justify-content-center mt-6">
			<div class="col-6 md:col-6 text-center">
				<div class="card p-shadow-8">
					<h2 class="p-2">Select search method to add companies in list</h2>
					<div class="grid">
						<div class="col-6">
							<div class="card">
								<p-radioButton name="searchMethod" value="personLinkedin" label="Search by People" binary="true" [(ngModel)]="searchMethod" inputId="number"></p-radioButton>
							</div>
						</div>
						<div class="col-6">
							<div class="card">
								<p-radioButton name="searchMethod" value="companyLinkedin" label="Search by Company" binary="true" [(ngModel)]="searchMethod" inputId="name"></p-radioButton>
							</div>
						</div>
						<div class="col-12 text-left">
							<i class="ui-icon-info-outline mr-3"></i><strong class="c-light font-italic">Guidance</strong>
							<ul class="pl-0">
								<li class="ml-6 c-light font-italic">You can type in or paste list or upload csv of company linkedin or person linkedin.</li>
								<li class="ml-6 c-light font-italic">If you prefer to upload CSV with company linkedin then header should be "Company" and for person linkedin header should be "People"</li>
								<!-- <li class="ml-6 c-light font-italic">At a time, 1000 companies can be uploaded.</li> -->
								<!-- <li class="ml-6 c-light font-italic">This search method is applicable only for Live companies.</li> -->
							</ul>
						</div>
						<div class="col-12 text-center">
							<button pButton type="button" class="p-button-rounded p-button-lg" label="Next" (click)="next()"></button>
						</div>
					</div>
				</div>	
			</div>
		</div>
	</ng-container>
</div>
<!-- </ng-container> -->

<ng-container *ngIf="displayUplaodPanel">
	<div>
		<button pButton label="back" type="button" class="p-button-rounded p-button-lg" (click)="back()"></button>
		<div class="grid">
			<div class="col-6 md:col-5">
				<div class="card mb-0">
					<ng-container *ngIf="searchMethod == 'companyLinkedin'; else companyNameBlock">
						<div class="grid">
							<div class="col-9">
								<strong class="c-green">Search by Company</strong>. Please upload CSV/input list with Company Linkedin.
							</div>
							<!-- <div class="col-3 text-pink-500">
								<p-checkbox [(ngModel)]="includeDissolvedCheckBool" [binary]="true" label="Include Dissolved" inputId="binary"></p-checkbox>
							</div> -->
						</div>
					</ng-container>
					<ng-template #companyNameBlock>
						<strong class="c-green">Search by People</strong>. Please upload CSV/input list with Person Linkedin.
						<!-- <div class="grid">
							<div class="col-9">
								<div class="flex p-ai-center justify-content-between mt-2 onlyLinesAround card">
									<p-radioButton name="searchType" value="similarMatch" (onClick)="clearListBox()" label="Search similar match" binary="true" [(ngModel)]="searchType" inputId="searchType2"></p-radioButton>
									<p-radioButton name="searchType" value="exactMatch" (onClick)="clearListBox()" label="Search exact match" binary="true" [(ngModel)]="searchType" inputId="searchType1"></p-radioButton>
								</div>
							</div>
							<div class="onlyLinesAround card col-3 includeDissolved">
								<p-checkbox [(ngModel)]="includeDissolvedCheckBool" [binary]="true" label="Include Dissolve" inputId="binary"></p-checkbox>
							</div>
						</div>						 -->
					</ng-template>
					<div class="searchDirectCompanySection">
						<div class="fixedWidthContainer">
							<div class="grid">
								<div class="col-12">
									<p-card>
										<input type="text" pInputText name="file_name" [(ngModel)]="file_name" size="30" placeholder="File Name" disabled />
									</p-card>
									<small><a class="text-primary-600 cursor-pointer hoveringStyle" (click)="downloadSampleCsvFile()">Click for sample CSV file</a></small>
								</div>
								<div class="col-12 text-center">
									<button pButton type="button" class="p-button-rounded p-button-lg" icon="pi pi-upload" label="Upload Csv" (click)="uploadCsvButton()" [disabled]="companyPersonLinkedinList.length > 0"></button>
								</div>
							</div>
						</div>
					</div>
		
					<div class="text-center mt-1 mb-1">OR</div>
					<ng-container *ngIf="searchMethod == 'companyLinkedin'; else companyNameNoteBlock">
						<div class="c-light font-italic"><small>( *Note : Please input company linkedin separated by comma ' , ' or should be on separate line. )</small></div>
					</ng-container>
					<ng-template #companyNameNoteBlock>
						<div class="c-light font-italic"><small>( *Note : Please input person linkedin separated by comma ' , ' or should be on separate line. )</small></div>
					</ng-template>
					<div *ngIf="showUploadLimitBoolean && userAuthService.hasRolePermission( ['Super Admin'] ); else other" class="c-red font-italic"><small>( Limit exceeds! Please input linkedin list upto 5000. )</small></div>
					<ng-template #other>
						<div *ngIf="showUploadLimitBoolean" class="c-red font-italic"><small>( Limit exceeds! Please input linkedin list upto 1000. )</small></div>
					</ng-template>
		
					<div class="mt-3">
						<textarea pInputTextarea rows="19" cols="100" [(ngModel)]="companyPersonLinkedinList" class="textAreaStyle" ></textarea>
						<div class="col-12 text-center">
							<button pButton type="button" class="p-button-rounded p-button-lg mr-1" label="Search" (click)="searchInputText()" [disabled]="companyPersonLinkedinList.length === 0"></button>

							<button pButton type="button" class="p-button-rounded p-button-lg ml-1 darkGrey" label="Clear" (click)="clearInputText()"></button>
						</div>
					</div>
		
				</div>
			</div>
			<div class="col-6 md:col-7">
				<div class="card h-full">
					<div class="grid h-full">

						<div class="col-6">
							<div class="card onlyLinesAround h-full">
								<div class="card-header">
									<ng-container *ngIf="searchType == 'exactMatch'; else similarBlock">
										<h5>Exact Match</h5>
									</ng-container>
									<ng-template #similarBlock>
										<h5>Matched URL</h5>
									</ng-template>
								</div>
								<div class="m-2" *ngIf="exactMatchListOptions.length > 0 && exactMatchListOptions.length < 2">{{ exactMatchListOptions.length }}  Result Found</div>
								<div class="m-2" *ngIf="exactMatchListOptions.length > 1">{{ exactMatchListOptions.length }}  Results Found</div>
								<div class="card-body">
									<ng-container *ngIf="exactMatchListOptions.length === 0">
										<div class="c-light font-italic"><small>( *Note : To get the results please use upload CSV or provide company linkedin/person linkedin in text area and press search )</small></div>
									</ng-container>
									<ng-container *ngIf="exactMatchListOptions.length !== 0; else noRecordTmeplate">
										<div class="mt-1">
											<p-listbox [options]="exactMatchListOptions" optionLabel="companyName" [filter]="true" styleClass="p-listboxStyle" [listStyle]="{'max-height':'250px'}" >
												<ng-template let-matchItem pTemplate="item">
													<div>
														<span class="font-medium text-black-alpha-80">{{ matchItem.companyName | titlecase }}</span>

														<span class="font-medium" *ngIf="matchItem.companyNumber"> | </span> 
														<span class="font-medium text-cyan-800">{{ matchItem.companyNumber | titlecase }}</span>

														<span class="font-medium" *ngIf="(matchItem[ urlObject[searchMethod] ] && matchItem.companyNumber) || (matchItem[ urlObject[searchMethod] ] && matchItem.companyName)"> | </span> 
														<span class="text-base text-indigo-400">{{ matchItem[ urlObject[searchMethod] ] }}</span> 
													</div>
												</ng-template>
											</p-listbox>
										</div>
									</ng-container>
								</div>
								<div class="flex justify-content-center">
									<div class="col-fixed">
										<dg-add-company-to-list [thisPage]="searchMethod == 'companyLinkedin' ? 'companyLinkedInCsv' : 'personLinkedInCsv'" (messageCommunicator)="getMessage($event)" [disableButton]="exactMatchListOptions.length === 0" [addAllListOfCompArr]="addAllListOfCompArr"></dg-add-company-to-list>
									</div>
								</div>
							</div>
						</div>

						<div class="col-6">
							<div class="card onlyLinesAround h-full">
								<div class="card-header">
									<h5>No Match</h5>
								</div>
								<div class="card-body">
									<ng-container *ngIf="noMatchListOptions.length === 0">
										<div class="c-light font-italic"><small>( *Note : To get the results please use upload CSV or provide company linkedin/person linkedin in text area and press search )</small></div>
									</ng-container>
									
									<ng-container *ngIf="noMatchListOptions.length; else noRecordTmeplate">
									
										<div class="grid no-gutter align-items-end">
											<div class="col"><small>{{ noMatchListOptions.length }} Result{{ noMatchListOptions.length > 1 ? 's' : '' }} Found</small></div>
											<div class="col-fixed">
												<button pButton type="button" class="p-button-rounded p-button-sm m-0" label="Copy" icon="pi pi-copy" (click)="copyText( noMatchedTextarea )"></button>
											</div>
										</div>
										
										<div class="mt-1">
											<textarea #noMatchedTextarea pInputTextarea rows="19" cols="100" [ngModel]="noMatchListOptions.join('\n')" [readOnly]="true" class="textAreaStyle" ></textarea>
										</div>

									</ng-container>
								</div>
							</div>
						</div>

					</div>
				</div>
				
			</div>
		</div>
	</div>
</ng-container>

<p-dialog header="Upload Csv" [(visible)]="uploadCsvBool" [draggable]="false" [style]="{width: '500px', height: 'auto'}" [modal]="true" [closable]="true">
	<form>
		<div class="col mt-4">
			<p-fileUpload #fileUploader name="file[]" id="chooseFile" accept=".csv" customUpload="true" maxFileSize="500000" multiple="multiple" (uploadHandler)="onSelectedFile($event)">
				<ng-template let-file pTemplate='file'>
					<div class="upload-file">
						<span>{{ file.name }} </span>
						<span class="ml-2">{{ file.size }} Kb</span>
					</div>
				</ng-template>
			</p-fileUpload>
		</div>
	</form>
</p-dialog>

<p-dialog header="Add List" [(visible)]="displayModal" [draggable]="false" [style]="{width: '500px', height: 'auto'}" [modal]="true" [closable]="true" (onHide)="listboxReset = !listboxReset">
	<p-listbox *ngIf="listboxReset" [options]="favList" #Listbox (keyup)="keyupSearch(Listbox)" (onClick)="selectList($event)" [(ngModel)]="ListArrayData" filter="filter" optionLabel="name" [listStyle]="{'max-height':'250px'}"></p-listbox>
	<div *ngIf="recordsAfterFilter">
		<h4>
			<p class="pt-2">No records found, Do you want to create
				<strong>
					<u>{{ newCreateListName }}</u>
				</strong> List?
			</p>
			<div class="text-center">
				<button type="button" pButton label="Yes" class="p-button-rounded p-button-sm" (click)="onUploadData()"></button>
				<button type="button" pButton label="No" class="p-button-rounded p-button-sm p-ml-2" (click)="clearFilterField($event)"></button>
			</div>
		</h4>
	</div>
</p-dialog>

<ng-template #noRecordTmeplate>
	<div class="noRecords">
		<p>No Result Found</p>
	</div>
</ng-template>