<button pButton type="button" label="Export" icon="ui-icon-insert-drive-file" class="p-button-rounded p-button-sm mr-3 hideBlockForMobileView mb-xxl-2" [ngClass]="{ 'hasFeatureLockIcon': subscribedPlanModal['Valentine_Special'].includes( userDetails?.planId ) || !subscriptionInActive }" [disabled]="thisPage == 'companySearch' && ( !preparedPayloadExport.filterData.length && selectedCompany.length == 0 && !( activeRoute.snapshot.queryParams['cListId'] ) ) || exportAllButton || this.listDataValues.length === 0" (click)="selectDataToExportDialog( $event )" title="Export all companies from the list">
    <span *ngIf="subscribedPlanModal['Valentine_Special'].includes( userDetails?.planId ) || !subscriptionInActive" class="featureLockIconForDetailsPage"><img src="{{ userAuthService.featureLockIconPath }}"></span>
</button>

<ng-container *ngIf="( userAuthService.isLoggedInSubject$ | async ) && ![ 'companySearch', 'diversityInclusion', 'otherRelatedCompanies', 'showContactScreen' ].includes( thisPage )">
	<button pButton type="button" label="Export To Email" icon="ui-icon-insert-drive-file" class="p-button-rounded p-button-sm mr-2 hideBlockForMobileView " [ngClass]="{ 'hasFeatureLockIcon': subscribedPlanModal['Valentine_Special'].includes( userDetails?.planId ) }" (click)="customEmailOrNot( $event )" [disabled]="(showExportButton || this.listDataValues.length === 0)">
		<span *ngIf="subscribedPlanModal['Valentine_Special'].includes( userDetails?.planId )" class="featureLockIconForDetailsPage"><img src="{{ userAuthService.featureLockIconPath }}"></span>
	</button>
</ng-container>

<!-- Login Modal Dialog -->
<p-dialog styleClass="loginDialogModal" [modal]="true" [(visible)]="showLoginDialog" [baseZIndex]="999999998" appendTo="body" [focusOnShow]="false">
	<dg-login></dg-login>
</p-dialog>
<!-- Login Modal Dialog End -->

 <!-- Upgrade Plan Dialog -->
 <p-dialog styleClass="subscriptionPlanDialogModal" [modal]="true" [(visible)]="showUpgradePlanDialog" [baseZIndex]="999999998" appendTo="body" [focusOnShow]="false" [style]="{width: '60vw'}">
	<dg-upgrade-plan [currentPlan]="userDetails?.planId" [componentView]="'inModal'"></dg-upgrade-plan>
</p-dialog>
<!-- Upgrade Plan Dialog End -->

<!-- Upgrade plan dialog modal start -->
<p-dialog styleClass="loginDialogModal" [modal]="true" [(visible)]="showSubscriptionInActiveDialog" [baseZIndex]="999999998" appendTo="body" [focusOnShow]="false" [style]="{width: '50vw'}">
	<dg-subscription-inactive></dg-subscription-inactive>
</p-dialog>
<!-- Upgrade plan dialog modal end -->

<ng-container *ngIf="( userAuthService.isLoggedInSubject$ | async )">

	<p-dialog header="Ready To Export" styleClass="downloadReportModalDialog" [(visible)]="exportCompanyDataDialog" [modal]="true" [style]="{width: '75vw'}" [baseZIndex]="99999999" appendTo="body" [draggable]="false" [resizable]="true" [focusOnShow]="false" [blockScroll]="true">
	
		<div class="grid">
			<div class="col-12 md:col-7 lg:col-8">
	
				<div class="card onlyLinesAround mb-0 customiseFileNameBlock">
					<p class="m-0">
						<span>File Name: <strong><em>{{ exportListDynamicNameCustom ? exportListDynamicNameCustom : exportListDynamicName }}</em></strong></span>
						<button pButton type="button" icon="pi pi-times" class="p-button-sm p-button-danger ml-2 mb-0" *ngIf="exportListDynamicNameCustom" (click)="exportListDynamicNameCustom = '';"></button>
						<button pButton type="button" icon="{{ !showHideCustomNameField ? 'ui-icon-edit' : ( exportListDynamicNameCustom ? 'ui-icon-check' : 'pi pi-times' ) }}" class="p-button-sm ml-2 mb-0" (click)="showHideCustomNameField = !showHideCustomNameField; exportListDynamicNameCustom ? customName = true : customName = false;"></button>
					</p>
					<div class="mt-3 p-input-filled" *ngIf="showHideCustomNameField">
						<div class="p-float-label">
							<input type="text" pInputText name="fileName" [pKeyFilter]="noSpecialCharacter" [(ngModel)]="exportListDynamicNameCustom" style="width: 100%">
							<label>Your File Name</label><span class="pt-1 specialCharacters">Punctuation marks or special characters are not allowed (e.g., #, *, &#64;, /, -)</span>
						</div>
						<span *ngIf="fileNameError" class="c-red">
							<small>Please enter a file name.</small>
						</span>
					</div>
				</div>
	
			</div>
	
			<div class="col-12 md:col-5 lg:col-4 text-right">
				<div class="grid">
					<div class="col">
						<div class="card onlyLinesAround mb-0">
							<p class="m-0">
								<span [ngClass]="{ 'c-green': limitDisplayForCustomExport > 100, 'c-red': limitDisplayForCustomExport < 101 }">
									{{ limitDisplayForCustomExport | number : '1.0-0' }}
								</span>
							</p>
							<small><em>Available limits</em></small>
						</div>
					</div>
					<div class="col">
						<div class="card onlyLinesAround mb-0">
							<p class="m-0">
								<ng-container *ngIf="!exportAllCondition; else exportAll">
									<span class="c-voilet">{{ toBeExportedCount | number : '1.0-0' }}</span>
								</ng-container>
								<ng-template #exportAll>
									<span class="c-voilet">
										<strong>{{ (thisPage !== 'showContactScreen' ? toBeExportedCount : searchTotalCount) | number : '1.0-0' }}</strong>
									</span>
									<span *ngIf="thisPage === 'showContactScreen'"> contacts</span>
									<span> out of <strong>{{ (thisPage !== 'showContactScreen' ? searchTotalCount : newCompanyCount) | number : '1.0-0' }}</strong> companies are prepared to export</span>
								</ng-template>
							</p>
							<ng-container *ngIf="!exportAllCondition">
								<small>
									<em>{{ thisPage !== 'showContactScreen' ? 'companies' : 'contacts' }} ready to export</em>
								</small>
							</ng-container>
						</div>
					</div>
			
				</div>
			</div>

		</div>

		<ng-container *ngIf="userAuthService.hasRolePermission(['Super Admin'])">
			<div class="ml-2" *ngIf="thisPage != 'showContactScreen'">
				<p-checkbox [(ngModel)]="fetchVerifyEmail" binary="true" label="Fetch Verify Email"></p-checkbox>
			</div>
		</ng-container>
	
		<dg-export-common-cards *ngIf="exportCompanyDataDialog" [savedListArray]="savedListArray" [thisPage]="thisPage" (selectedCardForExport)="selectedCardForExport($event)" (selectedSavedListForExport)="selectedSavedListForExport($event)" (selectedSheetTypeForExport)="getSheetType($event)"></dg-export-common-cards>
		
		<p-footer>
			<div class="text-center p-2">
	
				<button pButton type="button" label="Download" class="p-button-rounded" [ngClass]="{ 'hasFeatureLockIcon': subscribedPlanModal['Valentine_Special'] .includes( userDetails?.planId ) }" *ngIf="thisPage !== 'watchListPage' && !exportAllCondition" icon="ui-icon-insert-drive-file" (click)="customExportLimitCheck( 'export' )">
					<span *ngIf="subscribedPlanModal['Valentine_Special'].includes( userDetails?.planId )" class="featureLockIconForDetailsPage"><img src="{{ userAuthService.featureLockIconPath }}"></span>
				</button>
	
				<button pButton type="button" label="Download All" class="p-button-rounded" [ngClass]="{ 'hasFeatureLockIcon': subscribedPlanModal['Valentine_Special'] .includes( userDetails?.planId ) }" *ngIf="thisPage !== 'watchListPage' && exportAllCondition" icon="ui-icon-insert-drive-file" (click)="customExportLimitCheck( 'all' )" [disabled]="showExportButton || this.listDataValues.length === 0">
					<span *ngIf="subscribedPlanModal['Valentine_Special'].includes( userDetails?.planId )" class="featureLockIconForDetailsPage"><img src="{{ userAuthService.featureLockIconPath }}"></span>
				</button>			

				<button pButton type="button" icon="ui-icon-mail-outline" label="Send To Email" class="p-button-rounded ml-2" [ngClass]="{ 'hasFeatureLockIcon': subscribedPlanModal['Valentine_Special'] .includes( userDetails?.planId ) }" *ngIf="!['watchListPage', 'showContactScreen'].includes(thisPage) && this.listDataValues && !exportAllCondition" (click)="customEmailOrNot()" [disabled]="showExportButton || this.listDataValues.length === 0">
					<span *ngIf="subscribedPlanModal['Valentine_Special'].includes( userDetails?.planId )" class="featureLockIconForDetailsPage"><img src="{{ userAuthService.featureLockIconPath }}"></span>
				</button> 
	
				<button pButton type="button" label="Cancel" class="p-button-rounded p-button-lg ml-2 darkGrey" *ngIf="thisPage !== 'watchListPage'" (click)="exportCompanyDataDialog=false"></button>
	
			</div>
		</p-footer>
	
	</p-dialog>
	
	<!-- Export to email modal  -->
	<p-dialog header="Email Export" [(visible)]="customEmailOrNotdialog" [modal]="true" appendTo="body" [style]="{width: '35vw'}" [draggable]="false" [focusOnShow]="false" (onHide)="customEmailOrNotdialog=false; ">
	
		<div class="text-center" *ngIf="!customEmail">
			<p>{{ constantMessages['confirmation']['sendToOtherEmail'] }}</p>
	
			<button pButton class="p-button-rounded mr-2 p-button-lg" (click)="customEmail=true; customEmailBoolYes=true" type="button" label="Yes"></button>
				
			<ng-container *ngIf="![ 'companySearch', 'diversityInclusion', 'showContactScreen' ].includes( thisPage )">
				<button pButton class="p-button-rounded mr-2 p-button-lg darkGrey" (click)="selectDataToExportDialog( $event, 'exportToEmail' )" type="button" label="No"></button>
			</ng-container>
			
			<ng-container *ngIf="[ 'companySearch', 'diversityInclusion', 'showContactScreen' ].includes( thisPage )">
				<button pButton class="p-button-rounded p-button-lg darkGrey" (click)="customExportLimitCheck( 'email' )" type="button" label="No"></button>
			</ng-container>
			
		</div>
		<div *ngIf="customEmail">
			<div class="p-input-filled col-12 md:col-3 lg:col-12">
				<span class="p-float-label">
					<input id="float-input" type="email" pInputText name="email" (keyup)="validateEmail( customEmailId )" [(ngModel)]="customEmailId" autocomplete="off" [pattern]="emailPattern" #offEmail="ngModel" placeholder="Email" style="width: 100%;">
				</span>
				<div *ngIf="offEmail.errors">
					<div style="color: red;" *ngIf="offEmail.errors.pattern"> 
						Email not valid.
					</div>	
				 </div>
			</div>
		</div>
		<p-footer>
			<div class="text-center">
				<button *ngIf="customEmail" pButton class="p-button-rounded darkGrey" (click)="customEmail=false" type="button" label="Back"></button>
				
				<ng-container *ngIf="![ 'companySearch', 'diversityInclusion', 'showContactScreen' ].includes( thisPage )">
					<button pButton *ngIf="customEmail" class="p-button-rounded" (click)="selectDataToExportDialog( $event )" [disabled]=" emailValidateBool == false || showExportButton || this.listDataValues.length === 0" type="button" label="Send"></button>
				</ng-container>
				
				<ng-container *ngIf="[ 'companySearch', 'diversityInclusion', 'showContactScreen' ].includes( thisPage )">
					<button pButton *ngIf="customEmail" class="p-button-rounded ml-2" (click)="customExportLimitCheck( 'email' )" [disabled]="emailValidateBool == false || showExportButton || this.listDataValues.length === 0" type="button" label="Send"></button>
				</ng-container>
	
				<button pButton type="button" class="p-button-rounded darkGrey ml-2" (click)="customEmailOrNotdialog=false; customEmailId=''; customEmail=false" label="Close"></button>
			</div>
		</p-footer>
	</p-dialog>
	<!-- Export to email modal  -->
	
	<p-dialog header="Let's Go!" [(visible)]="csvDialogCustom" [modal]="true" [style]="{width: '35vw'}" [draggable]="false" [focusOnShow]="false">
		
		<div class="text-center">
			<!-- <p>{{ exportCSVDialogMessage }}</p> -->
			 <ng-container *ngIf="[ 'companySearch' ].includes( this.thisPage ) && exportCondition; else other">
				 <div class="col-12">
		 
					 <div class="grid">
						 <div class="col">
							 <div class="card onlyLinesAround mb-0">
								 <p class="m-0"><span [ngClass]="{ 'c-green': limitDisplayForCustomExport > 100, 'c-red': limitDisplayForCustomExport < 101 }">{{ limitDisplayForCustomExport | number : '1.0-0'}}</span></p>
								 <span><small>Available limits</small></span>
							 </div>
						 </div>
						 <div class="col">
							 <div class="card onlyLinesAround mb-0">
								 <p class="m-0"><span class="c-voilet">{{ toBeExportedCount | number : '1.0-0'}}</span></p>
								 <span><small> Credits to be used</small></span>
							 </div>
						 </div>
					 </div>
		 
				 </div>
			 </ng-container>
			 <ng-template #other>
				<p>{{ exportCSVDialogMessage }}</p>
			 </ng-template>
		</div>
	
		<p-footer>
			<div class="text-center">
				<ng-container *ngIf="thisPage == 'companySearch' && exportCondition">
					<button pButton class="p-button-rounded" (click)="exportExcel()" type="button" label="Yes"></button>
				</ng-container>
				<ng-container *ngIf="thisPage !== 'companySearch' && toMail.length == 0 && exportCondition">
					<button pButton class="p-button-rounded" (click)="exportExcel()" type="button" label="Yes"></button>
				</ng-container>
				<ng-container *ngIf="thisPage !== 'companySearch' && toMail.length > 0 && exportCondition">
					<button pButton class="p-button-rounded" (click)="exportCSVToMail()" type="button" label="Yes"></button>
				</ng-container>
				<button pButton class="p-button-rounded darkGrey" *ngIf="exportCondition" type="button" (click)="csvDialogCustom=false" label="No"></button>
				<button pButton *ngIf="!exportCondition" type="button" class="p-button-rounded darkGrey" (click)="csvDialogCustom=false" label="Close"></button>
			</div>
		</p-footer>
	
	</p-dialog>

</ng-container>